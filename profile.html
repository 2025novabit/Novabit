<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Login / Sign Up</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<script type="module" src="countries.js"></script>
<style>
body{font-family:Roboto,sans-serif;background:#f8f9fa;margin:0;height:100vh;display:flex;justify-content:center;align-items:center;}
.container{background:#fff;padding:30px;border-radius:10px;width:400px;box-shadow:0 0 15px rgba(0,0,0,0.1);}
h2{text-align:center;margin-bottom:20px;}
input, select{width:100%;padding:10px;margin:8px 0;border-radius:5px;border:1px solid #ccc;}
button{width:100%;padding:10px;margin:10px 0;border:none;border-radius:5px;background:#4b49ac;color:#fff;font-size:16px;cursor:pointer;}
button:hover{background:#3a3690;}
#msg{min-height:20px;font-weight:bold;text-align:center;}
</style>
</head>
<body>

<div class="container">
<h2>Login / Sign Up</h2>

<!-- Email / Password -->
<input type="email" id="email" placeholder="Email">
<input type="password" id="password" placeholder="Password">

<!-- Sign Up Additional -->
<input type="text" id="first_name" placeholder="First Name">
<input type="text" id="last_name" placeholder="Last Name">
<select id="country"><option value="">Select Country</option></select>
<input type="date" id="dob">

<button id="signupBtn">Sign Up</button>
<button id="loginBtn">Login</button>
<p id="msg"></p>
</div>

<script type="module">
import { createClient } from 'https://cdn.jsdelivr.net/npm/@supabase/supabase-js/+esm';
import { countries } from './countries.js';

// Supabase
const SUPABASE_URL = "https://iecnioogmafgxwarmkxz.supabase.co";
const SUPABASE_ANON_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImllY25pb29nbWFmZ3h3YXJta3h6Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3Njc3OTYwNDgsImV4cCI6MjA4MzM3MjA0OH0.3zkHQpwdYUVdf6_GkPfkLRu7xgWMaUHNuFmYMBgBsJA";
const supabase = createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

const msg = document.getElementById('msg');
const countrySelect = document.getElementById('country');

// populate countries
countries.forEach(c => {
  const opt = document.createElement('option');
  opt.value = c.name;
  opt.text = c.name;
  countrySelect.appendChild(opt);
});

// Sign Up
document.getElementById('signupBtn').addEventListener('click', async()=>{
  msg.style.color='red';
  msg.innerText='';
  const email = document.getElementById('email').value.trim();
  const password = document.getElementById('password').value.trim();
  const first_name = document.getElementById('first_name').value.trim();
  const last_name = document.getElementById('last_name').value.trim();
  const country = document.getElementById('country').value;
  const dob = document.getElementById('dob').value;

  if(!email||!password||!first_name||!last_name||!country||!dob){ msg.innerText="All fields required"; return; }

  try{
    const { data, error } = await supabase.auth.signUp({ email, password });
    if(error) throw error;

    // insert into users table
    await supabase.from('users').insert({ id: data.user.id, first_name, last_name, email, country, dob });

    msg.style.color='green';
    msg.innerText='Sign Up Successful ✅';
  }catch(e){ msg.innerText=e.message; }
});

// Login
document.getElementById('loginBtn').addEventListener('click', async()=>{
  msg.style.color='red';
  msg.innerText='';
  const email = document.getElementById('email').value.trim();
  const password = document.getElementById('password').value.trim();
  if(!email||!password){ msg.innerText="Enter email & password"; return; }
  try{
    const { data, error } = await supabase.auth.signInWithPassword({ email, password });
    if(error) throw error;
    msg.style.color='green';
    msg.innerText='Login Successful ✅';
    window.location.href='profile.html';
  }catch(e){ msg.innerText=e.message; }
});
</script>

</body>
</html>
