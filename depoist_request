<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Deposit Request | Novabit</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body{
  font-family:Arial,sans-serif;
  background:#f8f9fa;
  margin:0;
}
header{
  background:#1a1a2e;
  color:#fff;
  padding:15px;
  text-align:center;
}
.container{
  padding:20px;
  max-width:420px;
  margin:auto;
}
label{
  display:block;
  margin-top:15px;
  font-weight:bold;
}
input,select{
  width:100%;
  padding:10px;
  margin-top:5px;
  border-radius:6px;
  border:1px solid #ccc;
}
button{
  width:100%;
  margin-top:20px;
  padding:12px;
  background:#4b49ac;
  color:#fff;
  border:none;
  border-radius:6px;
  font-size:16px;
  cursor:pointer;
}
button:disabled{
  background:#aaa;
}
.msg{
  margin-top:15px;
  font-size:14px;
}
</style>
</head>

<body>

<header>
  Deposit Request
</header>

<div class="container">

  <label>Asset</label>
  <input id="asset" placeholder="BTC">

  <label>Network</label>
  <input id="network" placeholder="Bitcoin">

  <label>Amount</label>
  <input id="amount" type="number" step="0.00000001">

  <label>TXID (optional)</label>
  <input id="txid" placeholder="Transaction ID">

  <button onclick="submitRequest()">Submit Request</button>

  <div class="msg" id="msg"></div>
</div>

<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<script>
const SUPABASE_URL = 'https://iecnioogmafgxwarmkxz.supabase.co';
const SUPABASE_KEY = 'YOUR_ANON_KEY_HERE';

const supabaseClient = supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

async function submitRequest(){
  const asset = document.getElementById('asset').value.trim().toUpperCase();
  const network = document.getElementById('network').value.trim();
  const amount = document.getElementById('amount').value;
  const txid = document.getElementById('txid').value.trim();
  const msg = document.getElementById('msg');

  msg.innerText = '';

  if(!asset || !network || !amount){
    msg.innerText = 'Please fill all required fields';
    msg.style.color = 'red';
    return;
  }

  const { data: auth } = await supabaseClient.auth.getUser();
  if(!auth.user){
    msg.innerText = 'You must be logged in';
    msg.style.color = 'red';
    return;
  }

  const { error } = await supabaseClient
    .from('deposit_requests')
    .insert([{
      asset: asset,
      network: network,
      amount: amount,
      txid: txid || null,
      status: 'Pending',
      user_id: auth.user.id
    }]);

  if(error){
    console.error(error);
    msg.innerText = 'Failed to submit request';
    msg.style.color = 'red';
  }else{
    msg.innerText = 'Deposit request submitted successfully';
    msg.style.color = 'green';

    document.getElementById('amount').value = '';
    document.getElementById('txid').value = '';
  }
}
</script>

</body>
</html>
