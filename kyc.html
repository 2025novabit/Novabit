<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>KYC | Novabit</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body{
  margin:0;
  font-family:Roboto,sans-serif;
  background:#f4f6fa;
  padding-bottom:60px;
}

/* HEADER */
header{
  background:#1a1a2e;
  color:#fff;
  padding:15px 20px;
  display:flex;
  justify-content:space-between;
  align-items:center;
}
header button{
  background:#4b49ac;
  border:none;
  color:#fff;
  padding:8px 14px;
  border-radius:5px;
  cursor:pointer;
}

/* SIDE PANEL */
#sidePanel{
  position:fixed;
  top:0;
  right:-400px;
  width:33%;
  max-width:360px;
  height:100%;
  background:#fff;
  box-shadow:-3px 0 10px rgba(0,0,0,.2);
  padding:20px;
  overflow-y:auto;
  transition:right 0.3s;
  z-index:100;
}
#sidePanel.active{right:0;}
#sidePanel h2{margin-top:0;}
#sidePanel a{
  display:block;
  margin:10px 0;
  color:#1a1a2e;
  text-decoration:none;
  font-weight:500;
}

/* FORM */
.container{
  padding:20px;
}
form{ background:#fff;padding:20px;border-radius:10px;box-shadow:0 4px 8px rgba(0,0,0,.1);}
form h3{margin-top:0;margin-bottom:15px;}
form label{display:block;margin-top:10px;font-size:13px;color:#555;}
form input, form select{
  width:100%;
  padding:8px 10px;
  margin-top:5px;
  border:1px solid #ccc;
  border-radius:5px;
}
form input[type="file"]{
  padding:3px;
}
form button{
  margin-top:20px;
  padding:10px;
  background:#4b49ac;
  color:#fff;
  border:none;
  border-radius:5px;
  cursor:pointer;
}

/* STATUS */
#kycStatus{
  margin-top:15px;
  font-weight:bold;
  font-size:14px;
  color:#333;
}

/* LOGOUT */
.logoutBtn{
  width:100%;
  margin-top:20px;
  padding:10px;
  background:#e74c3c;
  border:none;
  color:#fff;
  border-radius:5px;
  cursor:pointer;
}

/* IMAGE PREVIEW */
img.preview{margin-top:10px;width:100%;border:1px solid #ccc;border-radius:5px;}

/* BOTTOM NAV */
.bottom-nav{
  position:fixed;
  bottom:0;
  width:100%;
  background:#1a1a2e;
  display:flex;
  justify-content:space-around;
  padding:10px 0;
  z-index:20;
}
.bottom-nav a{
  color:#fff;
  text-decoration:none;
  font-size:14px;
}
.bottom-nav a.active{color:#4b49ac;}

/* RESPONSIVE */
@media (max-width:768px){
  #sidePanel{width:70%;}
}
</style>
</head>

<body onload="requireLogin(); loadCountries(); loadKYC();">

<header>
  <h2>KYC Verification</h2>
  <button onclick="togglePanel()">Menu</button>
</header>

<!-- SIDE PANEL -->
<div id="sidePanel">
  <button onclick="togglePanel()" style="background:#e74c3c;color:#fff;padding:8px 12px;border:none;border-radius:5px;cursor:pointer;margin-bottom:15px;">Close</button>
  <h2>Menu</h2>
  <a href="profile.html">Profile</a>
  <a href="kyc.html" class="active">KYC</a>
  <a href="change_password.html">Change Password</a>
  <a href="2fa.html">2FA Settings</a>
  <a href="fees.html">Fees</a>
  <a href="referral.html">Referral</a>
</div>

<div class="container">
  <form id="kycForm">
    <h3>Complete Your KYC</h3>

    <label>Full Name</label>
    <input type="text" id="kycName" required>

    <label>Email</label>
    <input type="email" id="kycEmail" required>

    <label>Country</label>
    <select id="kycCountry" required>
      <option value="">Select Country</option>
    </select>

    <label>Document Type</label>
    <select id="kycDocType" onchange="showDocInputs()" required>
      <option value="">Select</option>
      <option value="passport">Passport</option>
      <option value="idcard">National ID</option>
    </select>

    <!-- Passport -->
    <div id="passportUpload" style="display:none;">
      <label>Upload Passport</label>
      <input type="file" id="passportFile" accept="image/*">
      <img id="passportPreview" class="preview">
    </div>

    <!-- ID Card -->
    <div id="idcardUpload" style="display:none;">
      <label>Upload ID Front</label>
      <input type="file" id="idFront" accept="image/*">
      <img id="idFrontPreview" class="preview">
      <label>Upload ID Back</label>
      <input type="file" id="idBack" accept="image/*">
      <img id="idBackPreview" class="preview">
    </div>

    <button type="submit">Submit KYC</button>
    <div id="kycStatus"></div>
  </form>
</div>

<script src="countries.js"></script>
<script>
// Toggle Side Panel
function togglePanel(){
  document.getElementById('sidePanel').classList.toggle('active');
}

// Demo login
function requireLogin(){
  console.log("Check login (demo mode)");
}

// Load countries
function loadCountries(){
  const select = document.getElementById('kycCountry');
  if(Array.isArray(countries)){
    countries.forEach(c=>{
      const opt = document.createElement('option');
      opt.value = c.name;
      opt.textContent = c.name;
      select.appendChild(opt);
    });
  }
}

// Show upload fields
function showDocInputs(){
  const type = document.getElementById('kycDocType').value;
  document.getElementById('passportUpload').style.display = (type==='passport')?'block':'none';
  document.getElementById('idcardUpload').style.display = (type==='idcard')?'block':'none';
}

// Image previews
function previewImage(inputId, previewId){
  const input = document.getElementById(inputId);
  const preview = document.getElementById(previewId);
  input.onchange = e=>{
    const file = input.files[0];
    if(file){
      preview.src = URL.createObjectURL(file);
    }
  }
}
previewImage('passportFile','passportPreview');
previewImage('idFront','idFrontPreview');
previewImage('idBack','idBackPreview');

// Submit KYC
document.getElementById('kycForm').onsubmit = e=>{
  e.preventDefault();
  const data = {
    name: document.getElementById('kycName').value,
    email: document.getElementById('kycEmail').value,
    country: document.getElementById('kycCountry').value,
    docType: document.getElementById('kycDocType').value,
    passportFile: document.getElementById('passportFile').files[0]?.name || '',
    idFront: document.getElementById('idFront').files[0]?.name || '',
    idBack: document.getElementById('idBack').files[0]?.name || '',
    status: 'Pending'
  };
  localStorage.setItem('kycData', JSON.stringify(data));
  loadKYC();
  alert("KYC Submitted! Status: Pending");
}

// Load KYC
function loadKYC(){
  const data = JSON.parse(localStorage.getItem('kycData') || '{}');
  if(Object.keys(data).length){
    document.getElementById('kycName').value = data.name || '';
    document.getElementById('kycEmail').value = data.email || '';
    document.getElementById('kycCountry').value = data.country || '';
    document.getElementById('kycDocType').value = data.docType || '';
    showDocInputs();
    if(data.docType==='passport') document.getElementById('passportPreview').src = data.passportFile ? data.passportFile : '';
    if(data.docType==='idcard'){
      document.getElementById('idFrontPreview').src = data.idFront || '';
      document.getElementById('idBackPreview').src = data.idBack || '';
    }
    document.getElementById('kycStatus').textContent = "KYC Status: " + (data.status || 'Pending');
  } else {
    document.getElementById('kycStatus').textContent = "KYC Status: Not submitted";
  }
}

// Disable Trade if KYC not approved
function checkTradeAccess(){
  const data = JSON.parse(localStorage.getItem('kycData') || '{}');
  if(!data.status || data.status !== 'Approved'){
    console.log("Trade disabled until KYC is approved");
    return false;
  }
  return true;
}
</script>

<div class="bottom-nav">
  <a href="dashboard.html">Home</a>
  <a href="wallet.html">Wallet</a>
  <a href="market.html">Market</a>
  <a href="trade.html">Trade</a>
  <a href="profile.html">Profile</a>
</div>

</body>
</html>
