<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Deposit</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

<style>
body{font-family:Roboto,Arial;background:#f5f6fa;margin:0}
header{background:#1a1a2e;color:#fff;padding:15px;text-align:center}
.container{max-width:1000px;margin:20px auto;padding:20px}
.coin{display:flex;align-items:center;gap:10px;background:#fff;
border:1px solid #ddd;padding:12px;border-radius:8px;margin-bottom:10px;cursor:pointer}
.coin img{width:32px;height:32px}
.panel{position:fixed;right:-400px;top:0;height:100%;width:360px;
background:#fff;box-shadow:-2px 0 10px rgba(0,0,0,.2);
padding:20px;transition:.3s}
.panel.active{right:0}
.close{background:#e74c3c;color:#fff;border:none;padding:6px 10px}
.address{background:#f1f1f1;padding:10px;margin-top:10px;font-family:monospace}
.notice{margin-top:20px;font-size:14px;color:#555}
</style>
</head>

<body>
<header>Deposit</header>

<div class="container" id="coinList">Loading coins...</div>

<div class="panel" id="panel">
  <button class="close" onclick="closePanel()">Close</button>
  <h3 id="title"></h3>
  <select id="network"></select>
  <div class="address" id="address"></div>

  <div class="notice">
    After making a deposit, please submit your deposit request.
    <br><br>
    <button onclick="location.href='deposit-request.html'">
      Submit Deposit Request
    </button>
  </div>
</div>

<script>
const supabase = supabaseJs.createClient(
  "https://YOUR_PROJECT_ID.supabase.co",
  "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImllY25pb29nbWFmZ3h3YXJta3h6Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3Njc3OTYwNDgsImV4cCI6MjA4MzM3MjA0OH0.3zkHQpwdYUVdf6_GkPfkLRu7xgWMaUHNuFmYMBgBsJA"
);

const coinList = document.getElementById("coinList");

async function loadCoins(){
  const { data:{ user } } = await supabase.auth.getUser();

  if(!user){
    coinList.innerHTML = "Please login to view deposit coins";
    return;
  }

  const { data:assets } = await supabase.from("assets").select("*");

  coinList.innerHTML = "";
  assets.forEach(a=>{
    const div=document.createElement("div");
    div.className="coin";
    div.innerHTML=`<img src="${a.icon_url}"><b>${a.symbol}</b> ${a.name}`;
    div.onclick=()=>openPanel(a.symbol,a.name);
    coinList.appendChild(div);
  });
}

async function openPanel(symbol,name){
  document.getElementById("title").innerText=name+" ("+symbol+")";
  const { data } = await supabase
    .from("deposit_wallets")
    .select("*")
    .eq("asset_symbol",symbol)
    .eq("is_active",true);

  const net=document.getElementById("network");
  net.innerHTML="";
  data.forEach(w=>{
    const o=document.createElement("option");
    o.value=w.address;
    o.innerText=w.network;
    net.appendChild(o);
  });

  document.getElementById("address").innerText=data[0]?.address||"";
  net.onchange=()=>document.getElementById("address").innerText=net.value;
  document.getElementById("panel").classList.add("active");
}

function closePanel(){
  document.getElementById("panel").classList.remove("active");
}

loadCoins();
</script>
</body>
</html>
